---
layout: post
title: Java JVM 调优总结与思考
category: 编程语言
tags: Java
keywords: Java,JVM
description: Java JVM 调优总结与思考
---

## 主题 1：JVM 参数分类

HotSpot JVM 提供了三类参数

### 标准参数 

顾名思义，标准参数中包括功能和输出的参数都是很稳定的，很可能在将来的JVM版本中不会改变。你可以用java命令（或者是用 java -help）检索出所有标准参数

### X参数

非标准化的参数在将来的版本中可能会改变。所有的这类参数都以-X开始，并且可以用java -X来检索。注意，不能保证所有参数都可以被检索出来，其中就没有-Xcomp。

### XX参数

在实际情况中X参数和XX参数并没有什么不同。X参数的功能是十分稳定的，然而很多XX参数仍在实验当中（主要是JVM的开发者用于debugging和调优JVM自身的实现）。

对于布尔类型的参数，我们有”+”或”-“，然后才设置JVM选项的实际名称。例如，-XX:+name用于激活name选项，而-XX:-name用于禁用name选项。
对于需要非布尔值的参数，如string或者integer，我们先写参数的名称，后面加上”=”，最后赋值。例如，  -XX:name=value给name赋值value。

## 主题 2：解释器与编译器优化

### 概述

* 在 Java 程序中，编译成 class 字节码文件后，当程序需要快速启动和执行的时候，**解释器**会首先发挥作用，立即执行。

* 当虚拟机发现某个方法或者代码块运行特别频繁时，就会把这些代码看作是“热点代码”（Hotspot code，这也是Hotspot VM的来由）,将这些代码**编译**成与本地平台相关的机器码，并进行各个层次的优化。负责这个过程的编译器称为即时编译器(JIT)

* HotSpot 虚拟机中内置了两个JIT编译器，分别为 Client Compiler 和 Server Compiler，也称为 C1 编译器和 C2 编译器。程序使用哪个编译器，取决于虚拟机的**运行模式**，运行模式默认与宿主机器的硬件性能和版本有关。也可以通过**-server 和 -client 参数**来指定。

![](http://cdn.taotaoshenqi.com/letcheng/jit.png)

### 模式选择

* 混合模式(Mixed)：解释器和编译器混合搭配的方式，默认开启，可以使用 -Xmixed 参数手动开启

* 解释模式(Interpreted)：用户可以使用 -Xint 强制不使用编译器，此时全部的代码都是使用解释方式执行

* 编译模式(Compiled)：用户可以使用 -Xcomp 强制执行改模式，这时将优先使用编译方式执行，但是编译无法执行的情况下，还是要使用解释器执行

通常的情况下，解释器可以**提高程序的启动速度**，而编译器可以**提高程序运行效率**，而混合模式刚好两者的一种平衡。

## 